
## Η δημιουργία της εφαρμογής του Παιχνιδιού (Arduplane)


Αφού συνδέσουμε μέσω το Arduino  στη θύρα usb (com 4) στον υπολογιστή, ανοίγουμε το  Arduino IDE και φορτώνουμε στο Arduino από τα “παραδείγματα” το  FirmataPlus. (Η εγκατάσταση των απαραίτητων ελεύθερων και ανοικτών λογισμικών αναλύεται στο https://github.com/8gymnperist/Robuino/blob/master/docs/support-docs.md )


Στη συνέχεια εκτελούμε την εντολή:

**s2aio  -p com4 -l 7**

οπότε στο περιβάλλον οπτικού προγραμματισμού του Scratch 2 στη κατηγορία “Άλλες εντολές” έχουμε διαθέσιμο το σύνολο των εντολών της επέκτασης s2aio. Εισάγουμε τ' αντικείμενα που συμμετέχουν στο παιχνίδι καθώς και τα υπόβαθρα για το σκηνικό. Στο παρακάτω παράθυρο φαίνεται η λίστα με το σύνολο των αντικειμένων που έχουμε εισάγει στο παιχνίδι.

![Github Robuino](/images/42.png)

Στη συνέχεια, εξηγείται ο ρόλος και ο χειρισμός κάθε  ενός αντικειμένου (επαναλαμβάνονται και εδώ, όπως και στη σελίδα σχεδιασμού του χειριστηρίου,  για διευκόλυνση του αναγνώστη) :

![Github Robuino](/images/43.png)**Το αντικείμενο “my-plane”** είναι το αεροπλάνο το οποίο έχει πάντα σταθερή τη τεταγμένη της θέσης του και μετακινείται μόνο δεξιά και αριστερά μέσα στα όρια της σκηνής. Η κίνησή του αυτή γίνεται με το ποτενσιόμετρο του χειριστηρίου. Όταν το ποτενσιόμετρο έχει περιστραφεί και βρίσκεται  στη μέση τότε το αεροπλάνο θα έχει τετμημένη χ ίση με 0. Με συνεχή περιστροφή του ποτενσιόμετρου αριστερά η τετμημένη χ του αεροπλάνου “my-plane” ελαττώνεται διαρκώς, μέχρις  ότου φθάνει στην ακραία αριστερή θέση του και τότε η τετμημένη χ θα έχει τιμή -240 (το my-plane θα βρεθεί στο αριστερό άκρο της σκηνής). Αντίθετα, με συνεχή περιστροφή του ποτενσιόμετρου δεξιά η τετμημένη χ του αεροπλάνου “my-plane” αυξάνεται διαρκώς, μέχρις  ότου φθάνει στην ακραία δεξιά θέση του και τότε η τετμημένη χ θα έχει τιμή 240 (το my-plane θα βρεθεί στο δεξί άκρο της σκηνής). Στην εικόνα του κυκλώματος του χειριστηρίου  φαίνεται ότι **την έξοδο του ποτενσιόμετρου την έχουμε συνδέσει στην αναλογική είσοδο Α2 του Arduino.**

![Github Robuino](/images/44.png)**Το αντικείμενο “fire”** είναι τα βλήματα που εκτοξεύει το αεροπλάνο “my-plane” όταν πατάμε το διακόπτη (S1) στο κύκλωμα του χειριστηρίου. Το αντικείμενο “fire” εκτοξεύεται από τη θέση που έχει το “my-plane” τη στιγμή που πατάμε το διακόπτη. Όταν αγγίζει εχθρικό αεροπλάνο το βλήμα εξαφανίζεται και παράλληλα αυξάνει το σκορ κατά 20 πόντους. 
To διακόπτη (S1) τον έχουμε συνδέσει στην ψηφιακή είσοδο 8 του Arduino.  Κάθε φορά που πατιέται ο διακόπτης το Arduino διαβάζει στην ψηφιακή είσοδό του 8 την τιμή “HIGH”. Έτσι, αντιλαμβάνεται πότε πυροβολούμε.

![Github Robuino](/images/45.png)**Το αντικείμενο “spaceship-flat-icon1”** είναι εχθρικό αεροπλάνο και φροντίζουμε να έρχεται κάθε φορά από την αντίθετη πλευρά από αυτή που βρίσκεται το “my-plane” και από διαφορετική τετμημένη. Όταν συγκρουσθεί με το αεροπλάνο μας (“my-plane”) χάνουμε μια από τις ζωές μας. Όταν το παιχνίδι αρχίζει έχουμε 3 ζωές. Έτσι, όταν συγκρουσθεί εχθρικό αεροπλάνο τρεις φορές με το “my-plane” το παιχνίδι τελειώνει. 

![Github Robuino](/images/46.png)Έχουμε εισάγει τρία αντικείμενα σε εικονίδιο καρδιάς και με ονόματα: **“Heart Face1”, “Heart Face2”, "Heart Face3”**, αντίστοιχα. Κάθε ένα απ’ αυτά αντιστοιχεί και σε μία ζωή του “my-plane”. Σε κάθε ένα απ’ αυτά  αντιστοιχεί και ένα αντίστοιχο λαμπάκι στο κύκλωμα του χειριστηρίου. Με την έναρξη του παιχνιδιού φροντίζουμε τα εικονίδια να είναι εμφανή και τ’ αντίστοιχα λαμπάκια στο χειριστήριο να είναι αναμμένα. Όταν χάνουμε μια ζωή (γιατί εχθρικό αεροπλάνο συγκρούεται με το “my-plane”), τότε εξαφανίζεται ένα εικονίδιο καρδιάς, σβήνει το αντίστοιχο λαμπάκι (led) στο χειριστήριο και από το buzzer που έχει συνδεθεί με την έξοδο 10 (τόνος) του Arduino ακούγεται ένας χαρακτηριστικός ήχος. Όταν χάνουμε την πρώτη ζωή εξαφανίζεται το “Heart Face1” και σβήνει στο χειριστήριο το λαμπάκι που έχει συνδεθεί με την ψηφιακή έξοδο 11 του Arduino. Με την δεύτερη ζωή που χάνουμε εξαφανίζεται το “Heart Face2” και σβήνει στο χειριστήριο το λαμπάκι που έχει συνδεθεί με την ψηφιακή έξοδο 12 του Arduino. Ενώ, όταν χάνουμε και την τρίτη ζωή τότε εξαφανίζεται το “Heart Face3”, σβήνει στο χειριστήριο το λαμπάκι που έχει συνδεθεί με την έξοδο 13 του Arduino και το παιχνίδι τελειώνει.

![Github Robuino](/images/49.png)**Το αντικείμενο “spaceship-flat-icon2”** είναι ένα δεύτερο εχθρικό αεροπλάνο το οποίο έρχεται μαζί με το αντικείμενο “spaceship-flat-icon1”  από την αντίθετη πλευρά εναντίον του “my-plane” και έτσι αυξάνεται ο βαθμός δυσκολίας του παιχνιδιού ενώ παράλληλα αλλάζει και το σκηνικό. Αυτό συμβαίνει όταν πατηθεί στο χειριστήριο ο διακόπτης  (S2), ο οποίος είναι συνδεδεμένος με την ψηφιακή είσοδο 9 του Arduino.

Με βάση τη λειτουργία και τη σχέση του κάθε αντικειμένου με το χειριστήριο (κύκλωμα: https://github.com/8gymnperist/Robuino/blob/master/hardware-design/sxediasmos.md ), όπως περιγράφηκε παραπάνω, προγραμματίστηκε και το σενάριό του.

Στα σενάρια που ακολουθούν έγινε χρήση κάποιων καθολικών μεταβλητών για όλα τ' αντικείμενα. Αυτές οι μεταβλητές εμφανίζονται και επεξηγείται ο ρόλος τους παρακάτω:

![Github Robuino](/images/57.png)

**Η μεταβλητή Σκορ:** Στη μεταβλητή εκχωρείται το σκορ του παιχνιδιού και εμφανίζεται στην οθόνη. Κάθε φορά που ξεκινά νέο παιχνίδι αρχικοποιείται (εκχωρείται τιμή 0). Με βάση τους κανόνες του παιχνιδιού η μεταβλητή αυξάνει κατά 20 πόντους όταν κάποιο βλήμα που εκτοξεύουμε από το “my-plane” πετυχαίνει (“αγγίζει”) εχθρικό αεροπλάνο. Επίσης αυξάνεται κατά πέντε πόντους κάθε φορά που εχθρικό αεροπλάνο διασχίζει την σκηνή χωρίς να κτυπήσει το “my-plane”.

**Η μεταβλητή Ζωές:**  Στην αρχή του παιχνιδιού εκχωρείται τιμή 3. Όταν χάνουμε ζωή μετά από σύγκρουση με εχθρικό αεροπλάνο η μεταβλητή ελαττώνεται κατά 1. Όταν η τιμή της μηδενισθεί τότε το παιχνίδι τελειώνει.

**Η μεταβλητή χ:** Στη μεταβλητή χ εκχωρείται η τιμή της τετμημένης της θέσης του “my-plane” στη σκηνή. Η τετμημένη προκύπτει μετά από μετασχηματισμό της τιμής που διαβάζει το Arduino από την αναλογική είσοδο Α2 (Όπως αναλύθηκε στη δραστηριότητα 4 https://github.com/8gymnperist/Robuino/blob/master/docs/support-docs.md). 

**Η μεταβλητή πύρ:** Αρχικά, η τιμή της τίθεται σε 0 και γίνεται 1 κάθε φορά που πατάμε το διακόπτη (S2) και το “my-plane” ρίχνει ένα βλήμα. Ακόμη, η μεταβλητή γίνεται 0 όταν το βλήμα φτάνει στο απέναντι άκρο της σκηνής και επιστρέφει στην απέναντι πλευρά με τετμημένη αυτή που έχει και το “my-plane”.

**Οι μεταβλητές Σημαία1, Σημαία2:** Με την έναρξη του παιχνιδιού εκχωρείται σ’ αυτές η τιμή 0. Όταν εχθρικό αεροπλάνο αγγίζει το “my-plane” και χάνουμε μια ζωή τότε σβήνει το πρώτο led και ακούγεται ήχος από το buzzer ενώ η μεταβλητή Σημαία γίνεται 1. Για όσο το παιχνίδι συνεχίζεται δεν θα ακούγεται ήχος και θα συμβεί ξανά (σβήνει led και ακούγεται ήχος) την επόμενη φορά που θα χάσουμε ζωή και τότε η μεταβλητή Σημαία2 θα γίνει 1. Το ίδιο θα γίνει ξανά όταν χάσουμε και την τελευταία μας ζωή.

Ακολούθως παραθέτουμε τα σενάρια που επισυνάψαμε σε κάθε αντικείμενο του παιχνιδιού αλλά και στο σκηνικό:

**Το σενάριο του αντικειμένου “my-plane”:**

Σ' αυτό οι μεταβλητές (που περιγράφηκαν παραπάνω) παίρνουν αρχικές τιμές (π.χ. η  **Σκόρ** γίνεται 0, η **ζωές** γίνεται 3, η **Σημαία1** και η **Σημαία2** γίνονται 0).

Μέσα στην εντολή επανάληψης "για πάντα" γίνεται έλεγχος για τα εξής:

-- εάν πατήθηκε ο διακόπτης **S1** (έλεγχος στον ακροδέκτη 8 του Arduino)οπότε και  μεταδίδεται το μήνυμα **"πύρ"**. Η χρήση και η σύνδεση  διακοπτών αναλύεται στο εκπαιδευτικό υλικό και στην εφαρμογή 2 (Βήμα 2)

-- εάν πατήθηκε ο διακόπτης **S2** (έλεγχος στον ακροδέκτη 9 του Arduino) οπότε και  μεταδίδεται το μήνυμα **"twice"**

Επίσης γίνεται έλεγχος στην αναλογική είσοδο Α2 και μετατρέπεται η τιμή εισόδου σε **τετμημένη χ του αεροπλάνου (my-plane)** για να κινείται σωστά όταν περιστρέφεται το ποτενσιόμετρο. Αναλυτική περιγραφή γίνεται στην **εφαρμογή 5 του εκπαιδευτικού υλικού (Βήμα 2)**

![Github Robuino](/images/50.png)

**Τα σενάρια του αντικειμένου “fire”:**

Όταν το αντικείμενο **"fire"** (σφαίρα) λάβει το μήνυμα **"πύρ"** τότε ξεκινά από τη θέση που έχει το αεροπλάνο "my-plane" και κινείται κατακόρυφα με αλλαγή της τεταγμένης της y κατά 12 (Η μεταβολή αυτή καθορίζει και τη ταχύτητα της σφαίρας). Αυτό επαναλαμβάνεται μέχρις ότου η σφαίρα είτε φθάσει στην απεναντι πλευρά (θέση του y > 176) είτε να αγγίξει κάποιο από τα εχθρικά αεροπλάνα οπότε και εξαφανίζεται.

![Github Robuino](/images/51.png)

**Το σενάριο του αντικειμένου “spaceship-flat-icon1”:**

![Github Robuino](/images/52.png)

Δείτε το βίντεο με την ανάλυση του σεναρίου του εχθρικού αεροπλάνου: https://drive.google.com/file/d/1u9XqAcyGiGidKGLngo6-MX2Ptql06Zvg/view?usp=sharing

**Το σενάριο του αντικειμένου “Heart Face1”:**

Εδώ ελέγχεται για πάντα εάν η μεταβλητή **ζωές** έχει τιμή 2 (έγινε πρώτη σύγκρουση του my-plane με εχθρικό αεροπλάνο) και η **Σημαία1** είναι 0, οπότε σβήνει το πρώτο λαμπάκι και ακούγεται ήχος (η Σημαία1 γίνεται 1 ώστε ο ήχος να σταματήσει και να μην συνεχίζεται).

![Github Robuino](/images/53.png)

**Το σενάριο του αντικειμένου “Heart Face2”:**

Εδώ ελέγχεται για πάντα εάν η μεταβλητή ζωές έχει τιμή 1 (έγινε δεύτερη σύγκρουση του my-plane με εχθρικό αεροπλάνο) και η Σημαία2 είναι 0, οπότε σβήνει το δεύτερο λαμπάκι και ακούγεται ήχος (η Σημαία2 γίνεται 1 ώστε ο ήχος να σταματήσει και να μην συνεχίζεται).

![Github Robuino](/images/54.png)

**Το σενάριο του αντικειμένου “Heart Face3”:**

Εδώ ελέγχεται για πάντα εάν η μεταβλητή **ζωές έχει τιμή 0** (έγινε τρίτη σύγκρουση του my-plane με εχθρικό αεροπλάνο),  οπότε σβήνει το τρίτο λαμπάκι ,  ακούγεται ήχος απώλειας ζωής και στη συνέχεια εμφανίζεται το υπόβαθρο **"backg3"** με το **GAME OVER**.

![Github Robuino](/images/55.png)

**Τα σενάρια του αντικειμένου “spaceship-flat-icon2”:**

Το δεύτερο εχθρικό αεροπλάνο εμφανίζεται στη σκηνή και συμπεριφέρεται όπως και το πρώτο (ίδιος κώδικας) όταν λάβει το μήνυμα **"twice"** (το οποίο στέλνεται όπως είδαμε όταν στο χειριστήριο πατηθεί ο διακόπτης **S2**).

![Github Robuino](/images/56.png)

**Τα σενάρια του σκηνικού:**

Όταν το παιχνίδι ξεκινά το υπόβαθρο γίνεται το **"backg1"**. Όταν λάβει το μήνυμα **"twice"** (οπότε εμφανίζεται και το δεύτερο εχθρικό αεροπλάνο με πάτημα του S2) εμφανίζεται άλλο υπόβαθρο το **"Backg2"**.

![Github Robuino](/images/58.png)

**Βίντεο για την παρουσίαση και τον έλεγχο του παιχνιδιού και του χειριστηρίου σε διάφορα λειτουργικά συστήματα: α) Windows 7, β) Raspbian για Rasoberry pi 3 και γ) linux Ubuntu Mate 18.04.**

https://drive.google.com/file/d/14k0kBwG6YBduTImlj3yZ-IMPIfs6TW3Q/view?usp=sharing 

